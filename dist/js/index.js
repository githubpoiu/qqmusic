var root=window.player,render=root.render,rotate=root.rotate,proController=root.proController,audioManager=null,audio=null,songList=[],index=0,len=0,frameTimer=-1;function getData(n){$.ajax({url:n,method:"GET",success:function(n){index=0,len=(songList=n).length,render(songList[0],index,songList),audioManager=new root.AudioManager(songList[index].audio),root.audio=audio=audioManager.audio,proController.init(audio),bindEvent()},error:function(){}})}function bindEvent(){var n=$(".pro-bottom").offset(),e=n.left,i=n.width;function t(n){var o=((n.clientX||n.changedTouches[0].clientX)-e)/i;return o<0&&(o=0),1<o&&(o=1),o}function a(){cancelAnimationFrame(frameTimer)}function r(n){var o;n&&(o=n.deg),audio.paused?(a(),$(".play").removeClass("playing")):(a(),function n(){rotate.updateDeg(),proController.updateByAudio(),audio.ended&&$(".next").trigger("click"),frameTimer=requestAnimationFrame(n)}(),$(".play").addClass("playing"),null!=o&&rotate.setDeg(o))}function o(){render(songList[index],index),audioManager.loadAudio(songList[index].audio),audio.play(),proController.updateBuffered(),r({deg:0})}$(".pro-box").on("click",function(n,o){var e=t(n=o||n);audioManager.playByPer(e),audio.ended?$(".next").trigger("click"):audioManager.play(),r()}),$(".spot").on("touchstart",function(n){return audioManager.pause(),r(),!1}).on("touchmove",function(n){var o=t(n);proController.updateByPer(o)}).on("touchend",function(n){$(".pro-box").trigger("click",n)}),$(".play").on("click",function(){audioManager.togglePlay(),r()}),$(".prev").on("click",function(){index=(index-1+len)%len,o()}),$(".next").on("click",function(){index=(index+1)%len,o()}),$(".btn.list").on("click",function(){$(".song-list").addClass("show")}),$(".close").add(".song-list").on("click",function(){$(".song-list").removeClass("show")}),$(".list-box").on("click",function(){return!1}),$(".song-item").on("click",function(n){index=$(this).index(),o()})}getData("/source/data.json"),window.onload=function(){setTimeout(function(){$(".loading").hide()},800)};
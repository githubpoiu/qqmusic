var root=window.player,render=root.render,rotate=root.rotate,proController=root.proController,audioManager=null,audio=null,songList=[],index=0,len=0,timer=-1;function getData(n){$.ajax({url:n,method:"GET",success:function(n){index=0,len=(songList=n).length,render(songList[0],index,songList),audioManager=new root.AudioManager(songList[index].audio),root.audio=audio=audioManager.audio,proController.init(),bindEvent()},error:function(){console.log("error")}})}function bindEvent(){var n=$(".pro-bottom").offset(),e=n.left,t=n.width;function i(n){var o=((n.clientX||n.changedTouches[0].clientX)-e)/t;return o<0&&(o=0),1<o&&(o=1),o}function r(){clearInterval(timer)}function a(n){var o;n&&(o=n.deg),audio.paused?(r(),$(".play").removeClass("playing"),rotate.stop()):(r(),timer=setInterval(function(){proController.updateByAudio(),audio.ended&&$(".next").trigger("click")},1e3/60),$(".play").addClass("playing"),null!=o?rotate.run(o):rotate.run())}function o(){audioManager.loadAudio(songList[index].audio),render(songList[index],index),proController.updateBuffered(),audio.play(),a({deg:0})}$(".pro-box").on("click",function(n,o){var e=i(n=o||n);audioManager.playByPer(e),audio.ended?$(".next").trigger("click"):audioManager.play(),a()}),$(".spot").on("touchstart",function(n){return audioManager.pause(),a(),!1}).on("touchmove",function(n){var o=i(n);proController.updateByPer(o)}).on("touchend",function(n){$(".pro-box").trigger("click",n)}),$(".play").on("click",function(){audioManager.togglePlay(),a()}),$(".prev").on("click",function(){index=(index-1+len)%len,o()}),$(".next").on("click",function(){index=(index+1)%len,o()}),$(".btn.list").on("click",function(){$(".song-list").addClass("show")}),$(".close").add(".song-list").on("click",function(){$(".song-list").removeClass("show")}),$(".list-box").on("click",function(){return!1}),$(".song-item").on("click",function(n){$(".song-list").addClass("show"),index=$(this).index(),o()})}getData("../mock/data.json"),window.onload=function(){$(".loading").hide()};